<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div id="pdf_input">
        <input type="file" id="inpFile">
        <button type="button" id="btnUpload" onclick="button_upload()">Upload</button>
        <br>
        <br>
        <textarea style="width: 300px; height: 150px;" id="resultText" placeholder="Your PDF text will appear here..."></textarea>
        <script>
            const inpFile = document.getElementById("inpFile");
            const btnUpload = document.getElementById("btnUpload");
            const resultText = document.getElementById("resultText");

            function button_upload(){
                const formData = new FormData();

                formData.append("pdfFile", inpFile.files[0]);

                fetch("/extract-text", {
                    method: "post",
                    body: formData
                }).then(response => {
                    return response.text();
                }).then(extractedText => {
                    resultText.value = extractedText.trim();
                });

                setTimeout(() => {  extract_fromtext(); }, 300);
                setTimeout(() => {  make_excel(); }, 500);
                
            };
        </script>
        <script>
            function make_excel(){
                document.getElementById("submit_form").click()
            }
        </script>
    </div>
    <div id="extractor">
        <table id="invoice_table">
            
        </table>
        <form method="post" action="/excel" hidden>
            <input type="text" name="shop" id="shop_input">
            <input type="submit" id="submit_form">
        </form>
        <script>
            function extract_fromtext(){
                const input_text = document.getElementById("resultText")
                const result = input_text.value.split(/\r?\n/);
                document.getElementById("shop_input").value = result[8]
                // Find a <table> element with id="myTable":
                var table = document.getElementById("invoice_table");

                // Create an empty <tr> element and add it to the 1st position of the table:
                i=0
                result.forEach(newrow)
                function newrow(item, index){
                var row = table.insertRow(index);

                // Insert new cells (<td> elements) at the 1st and 2nd position of the "new" <tr> element:
                var cell1 = row.insertCell(0);
                var cell2 = row.insertCell(1);

                // Add some text to the new cells:
                cell1.innerHTML = index;
                cell2.innerHTML = item;
                }
                
            }
        </script>
       <script src="../excel.js">

       </script>
    </div>
</body>
</html>